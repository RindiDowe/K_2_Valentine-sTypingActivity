<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Valentine Typing ‚Ä¢ K‚Äì2</title>
  <style>
    :root{
      --red:#d61f2c;
      --pink:#ff5fa2;
      --lightpink:#ffd6e6;
      --white:#ffffff;
      --ink:#1d1d1f;
      --gray:#f3f4f6;
      --shadow: 0 10px 24px rgba(0,0,0,.12);
      --radius:16px;

      /* Chromebook-ish safe size target */
      --maxW: 1200px;
      --maxH: 700px; /* keeps it inside 1366x768 with browser UI */
    }

    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background: radial-gradient(900px 500px at 20% 10%, var(--lightpink), transparent 55%),
                  radial-gradient(800px 450px at 80% 20%, rgba(255,95,162,.25), transparent 60%),
                  linear-gradient(135deg, #fff 0%, #fff 55%, rgba(214,31,44,.06) 100%);
      overflow:hidden; /* no page scroll */
    }

    .app{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .frame{
      width:min(var(--maxW), 100%);
      height:min(var(--maxH), calc(100% - 12px));
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(214,31,44,.14);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-rows: auto 1fr auto;
    }

    header{
      padding:14px 16px 10px 16px;
      background: linear-gradient(90deg, rgba(214,31,44,.09), rgba(255,95,162,.10));
      border-bottom:1px solid rgba(214,31,44,.12);
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }

    .title{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .badge{
      width:42px;height:42px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--red), var(--pink));
      display:grid; place-items:center;
      color:white;
      font-size:20px;
      box-shadow: 0 10px 18px rgba(214,31,44,.20);
      flex:0 0 auto;
    }
    h1{
      font-size:18px;
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .sub{
      font-size:12px;
      opacity:.8;
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex:0 0 auto;
    }

    .btn{
      border:0;
      border-radius: 999px;
      padding:10px 12px;
      font-weight:700;
      cursor:pointer;
      background: var(--red);
      color:white;
      box-shadow: 0 10px 16px rgba(214,31,44,.18);
      transition: transform .05s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: white;
      color: var(--red);
      border: 2px solid rgba(214,31,44,.25);
      box-shadow:none;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:8px;
      background: rgba(255,255,255,.8);
      border: 2px solid rgba(214,31,44,.16);
      padding:8px 10px;
      border-radius: 999px;
      font-size:12px;
      font-weight:700;
      user-select:none;
    }
    .toggle input{ accent-color: var(--red); width:18px; height:18px; }

    main{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
      padding:12px 16px;
      overflow:hidden; /* no scroll in main */
    }

    .card{
      background: white;
      border-radius: var(--radius);
      border: 2px solid rgba(214,31,44,.12);
      box-shadow: 0 10px 18px rgba(0,0,0,.06);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .cardHead{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(214,31,44,.10);
      background: linear-gradient(90deg, rgba(255,214,230,.55), rgba(214,31,44,.04));
    }
    .cardHead strong{
      font-size:13px;
    }

    .progressWrap{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      font-weight:800;
      color: rgba(29,29,31,.85);
    }
    .bar{
      width:220px;
      height:12px;
      background: rgba(214,31,44,.08);
      border-radius: 999px;
      overflow:hidden;
      border: 1px solid rgba(214,31,44,.14);
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--red), var(--pink));
      border-radius: 999px;
      transition: width .25s ease;
    }

    .taskArea{
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    .targetRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    .pill{
      border-radius:999px;
      padding:8px 10px;
      background: rgba(255,214,230,.55);
      border: 1px solid rgba(214,31,44,.14);
      font-weight:900;
      font-size:12px;
      color: rgba(29,29,31,.85);
    }

    .target{
      font-size:44px;
      font-weight:1000;
      letter-spacing: .08em;
      line-height:1;
      color: var(--red);
      text-shadow: 0 2px 0 rgba(214,31,44,.08);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .target .tiny{
      font-size:16px;
      font-weight:900;
      letter-spacing:0;
      color: rgba(29,29,31,.70);
    }

    .inputBox{
      display:flex;
      gap:10px;
      align-items:center;
      background: rgba(243,244,246,.9);
      border: 2px solid rgba(214,31,44,.16);
      border-radius: 16px;
      padding:10px 12px;
    }
    .inputBox input{
      width:100%;
      border:0;
      outline:none;
      font-size:22px;
      background:transparent;
      font-weight:800;
      letter-spacing:.02em;
    }
    .hint{
      font-size:12px;
      opacity:.78;
      margin-top:-2px;
    }

    .feedback{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-top:auto;
      padding-top:6px;
    }
    .status{
      font-weight:900;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:12px;height:12px;border-radius:999px;
      background: rgba(214,31,44,.25);
      box-shadow: inset 0 0 0 2px rgba(214,31,44,.25);
    }
    .dot.good{ background: rgba(16,185,129,.35); box-shadow: inset 0 0 0 2px rgba(16,185,129,.35); }
    .dot.bad{ background: rgba(239,68,68,.35); box-shadow: inset 0 0 0 2px rgba(239,68,68,.35); }

    /* Right card (keyboard + stats) */
    .rightBody{
      padding:10px 10px 12px 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:0;
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .stat{
      border-radius:14px;
      border: 1px solid rgba(214,31,44,.14);
      background: rgba(255,214,230,.32);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:70px;
    }
    .stat .label{
      font-size:12px;
      font-weight:900;
      opacity:.85;
    }
    .stat .value{
      font-size:20px;
      font-weight:1000;
      color: var(--red);
      line-height:1.1;
    }

    .keyboard{
      margin-top:2px;
      border-radius: 16px;
      border: 2px solid rgba(214,31,44,.12);
      background: white;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;
    }

    .kbdRow{
      display:grid;
      gap:6px;
    }
    .kbdRow.r1{ grid-template-columns: repeat(10, 1fr); }
    .kbdRow.r2{ grid-template-columns: repeat(9, 1fr); padding-left:18px; padding-right:18px;}
    .kbdRow.r3{ grid-template-columns: repeat(7, 1fr); padding-left:44px; padding-right:44px;}

    .key{
      height:44px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.10);
      background: linear-gradient(180deg, #fff, #f7f7f7);
      display:grid;
      place-items:center;
      font-weight:900;
      font-size:16px;
      user-select:none;
      position:relative;
      box-shadow: 0 6px 10px rgba(0,0,0,.06);
    }
    .key.small{ font-size:14px; }
    .key.isNext{
      outline: 3px solid rgba(255,95,162,.55);
      border-color: rgba(214,31,44,.28);
      background: linear-gradient(180deg, rgba(255,214,230,.95), #fff);
    }
    .key.isPressed{
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(0,0,0,.08);
      background: linear-gradient(180deg, rgba(214,31,44,.18), #fff);
    }
    .key.shift{
      grid-column: span 2;
      font-size:12px;
      letter-spacing:.04em;
    }
    .key.space{
      height:46px;
      border-radius: 14px;
      font-size:12px;
      letter-spacing:.1em;
    }

    footer{
      padding:10px 16px;
      border-top: 1px solid rgba(214,31,44,.12);
      background: rgba(255,255,255,.82);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-size:12px;
      overflow:hidden;
    }
    .footerLeft{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chip{
      padding:6px 10px;
      border-radius:999px;
      background: rgba(214,31,44,.08);
      border: 1px solid rgba(214,31,44,.14);
      font-weight:900;
    }

    /* Confetti-ish hearts */
    .hearts{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      opacity:.9;
    }
    .heart{
      position:absolute;
      font-size:18px;
      animation: floatUp 1.1s ease-out forwards;
      filter: drop-shadow(0 8px 10px rgba(0,0,0,.10));
    }
    @keyframes floatUp{
      0%{ transform: translateY(0) scale(.9); opacity:0; }
      15%{ opacity:1; }
      100%{ transform: translateY(-140px) scale(1.15); opacity:0; }
    }

    /* small screens fallback */
    @media (max-width: 980px){
      main{ grid-template-columns: 1fr; }
      .bar{ width: 160px; }
      :root{ --maxH: 760px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="frame" id="frame">
      <header>
        <div class="title">
          <div class="badge">‚ù§</div>
          <div style="min-width:0">
            <h1>Valentine Typing Practice (K‚Äì2)</h1>
            <div class="sub" id="subtitle">Level 1: lowercase a‚Äìm</div>
          </div>
        </div>

        <div class="controls">
          <label class="toggle" title="When ON, the keyboard shows the next key to press.">
            <input type="checkbox" id="assistToggle" checked />
            Assist
          </label>
          <button class="btn secondary" id="levelBtn" title="Switch levels">Change Level</button>
          <button class="btn" id="resetBtn" title="Start over">Reset</button>
        </div>
      </header>

      <main>
        <!-- LEFT: task -->
        <section class="card">
          <div class="cardHead">
            <strong>Type what you see</strong>
            <div class="progressWrap">
              <span id="progressText">0 / 13</span>
              <div class="bar" aria-label="progress bar">
                <div id="barFill"></div>
              </div>
            </div>
          </div>

          <div class="taskArea">
            <div class="targetRow">
              <div class="pill" id="levelPill">LEVEL 1</div>
              <div class="pill" id="goalPill">Lowercase letters</div>
            </div>

            <div class="target" id="target">
              a <span class="tiny">(type it!)</span>
            </div>

            <div class="inputBox">
              <input
                id="typeInput"
                type="text"
                autocomplete="off"
                autocapitalize="off"
                spellcheck="false"
                inputmode="text"
                placeholder="Type here‚Ä¶"
              />
            </div>
            <div class="hint" id="hint">
              Tip: Press the letter once. (For words, type the whole word.)
            </div>

            <div class="feedback">
              <div class="status" id="status">
                <span class="dot" id="dot"></span>
                <span id="statusText">Ready!</span>
              </div>
              <div class="pill" id="nextUp">Next: b</div>
            </div>
          </div>
        </section>

        <!-- RIGHT: keyboard + stats -->
        <section class="card">
          <div class="cardHead">
            <strong>Helper keyboard</strong>
            <div class="pill" id="capsPill">Caps: Off</div>
          </div>

          <div class="rightBody">
            <div class="stats">
              <div class="stat">
                <div class="label">Correct</div>
                <div class="value" id="correctCount">0</div>
              </div>
              <div class="stat">
                <div class="label">Tries</div>
                <div class="value" id="tryCount">0</div>
              </div>
            </div>

            <div class="keyboard" aria-label="on screen keyboard">
              <div class="kbdRow r1" id="row1"></div>
              <div class="kbdRow r2" id="row2"></div>
              <div class="kbdRow r3" id="row3"></div>
              <div style="display:grid; grid-template-columns: 1fr 2fr 1fr; gap:6px; margin-top:2px;">
                <div class="key shift" id="key-ShiftLeft">SHIFT</div>
                <div class="key space" id="key-Space">SPACE</div>
                <div class="key shift" id="key-ShiftRight">SHIFT</div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <div class="footerLeft">
          <span class="chip">How to play:</span>
          <span id="footerText">Type the letter shown. It will change when you get it right.</span>
        </div>
        <div class="chip" id="doneChip">Keep going! üíó</div>
      </footer>
    </div>
  </div>

  <script>
    // ---------- Content ----------
    const LEVELS = [
      {
        name: "LEVEL 1",
        subtitle: "Level 1: lowercase a‚Äìm",
        goal: "Lowercase letters",
        items: "abcdefghijklm".split(""),
        expects: (target, typed) => typed === target
      },
      {
        name: "LEVEL 2",
        subtitle: "Level 2: UPPERCASE N‚ÄìZ",
        goal: "Uppercase letters",
        items: "NOPQRSTUVWXYZ".split(""),
        expects: (target, typed) => typed === target
      },
      {
        name: "LEVEL 3",
        subtitle: "Level 3: Valentine words",
        goal: "Words",
        items: ["red","pink","flowers","card","candy","love","share","heart","note","nice","poem"],
        expects: (target, typed) => typed === target
      }
    ];

    // ---------- Keyboard layout (simple Chromebook-ish) ----------
    const ROW1 = ["Q","W","E","R","T","Y","U","I","O","P"];
    const ROW2 = ["A","S","D","F","G","H","J","K","L"];
    const ROW3 = ["Z","X","C","V","B","N","M"];

    // ---------- State ----------
    let levelIndex = 0;
    let idx = 0;
    let tries = 0;
    let correct = 0;

    // For highlighting shift usage when next target needs uppercase
    let capsVirtual = false; // used just for the UI "Caps: Off/On" indicator

    // ---------- Elements ----------
    const subtitle = document.getElementById("subtitle");
    const levelPill = document.getElementById("levelPill");
    const goalPill = document.getElementById("goalPill");
    const targetEl = document.getElementById("target");
    const nextUp = document.getElementById("nextUp");
    const typeInput = document.getElementById("typeInput");
    const statusText = document.getElementById("statusText");
    const dot = document.getElementById("dot");
    const barFill = document.getElementById("barFill");
    const progressText = document.getElementById("progressText");
    const correctCount = document.getElementById("correctCount");
    const tryCount = document.getElementById("tryCount");
    const capsPill = document.getElementById("capsPill");
    const footerText = document.getElementById("footerText");
    const doneChip = document.getElementById("doneChip");

    const assistToggle = document.getElementById("assistToggle");
    const levelBtn = document.getElementById("levelBtn");
    const resetBtn = document.getElementById("resetBtn");

    const row1 = document.getElementById("row1");
    const row2 = document.getElementById("row2");
    const row3 = document.getElementById("row3");

    // ---------- Build keyboard ----------
    function makeKey(label){
      const d = document.createElement("div");
      d.className = "key";
      d.textContent = label;
      d.dataset.key = label;
      return d;
    }
    function buildKeyboard(){
      row1.innerHTML = "";
      row2.innerHTML = "";
      row3.innerHTML = "";
      ROW1.forEach(k => row1.appendChild(makeKey(k)));
      ROW2.forEach(k => row2.appendChild(makeKey(k)));
      ROW3.forEach(k => row3.appendChild(makeKey(k)));
    }
    buildKeyboard();

    function clearKeyStates(){
      document.querySelectorAll(".key").forEach(k=>{
        k.classList.remove("isNext","isPressed");
      });
    }

    function highlightNextKey(){
      clearKeyStates();
      if(!assistToggle.checked) return;

      const current = getCurrentTarget();
      // Determine the next required *character* for highlighting:
      // - Levels 1 & 2: single letter
      // - Level 3: highlight first missing char based on what they've typed so far
      let neededChar = "";
      let needsSpace = false;

      if(levelIndex < 2){
        neededChar = current; // single char
      } else {
        const typed = typeInput.value;
        // If they already match the prefix, highlight next char; else highlight the first char they should try (still next correct char)
        const nextPos = Math.min(typed.length, current.length - 1);
        neededChar = current[nextPos] || "";
        if(neededChar === " ") needsSpace = true;
      }

      if(!neededChar) return;

      if(needsSpace){
        document.getElementById("key-Space")?.classList.add("isNext");
        capsVirtual = false;
        updateCaps();
        return;
      }

      const isLetter = /^[a-zA-Z]$/.test(neededChar);
      if(!isLetter) return;

      const upper = neededChar.toUpperCase();
      const lower = neededChar.toLowerCase();
      const needsShift = (neededChar === upper && neededChar !== lower); // uppercase letter

      // Highlight the letter key (shown as uppercase on the visual keyboard)
      document.querySelectorAll(".key").forEach(k=>{
        if(k.dataset.key === upper){
          k.classList.add("isNext");
        }
      });

      // Show shift highlight if uppercase is required
      if(needsShift){
        document.getElementById("key-ShiftLeft")?.classList.add("isNext");
        document.getElementById("key-ShiftRight")?.classList.add("isNext");
        capsVirtual = true;
      } else {
        capsVirtual = false;
      }
      updateCaps();
    }

    function updateCaps(){
      capsPill.textContent = "Caps: " + (capsVirtual ? "On" : "Off");
    }

    // ---------- Game logic ----------
    function getLevel(){ return LEVELS[levelIndex]; }
    function getCurrentTarget(){ return getLevel().items[idx]; }

    function setStatus(kind, text){
      dot.classList.remove("good","bad");
      if(kind === "good") dot.classList.add("good");
      if(kind === "bad") dot.classList.add("bad");
      statusText.textContent = text;
    }

    function updateProgress(){
      const level = getLevel();
      const total = level.items.length;
      progressText.textContent = `${idx} / ${total}`;
      const pct = Math.round((idx / total) * 100);
      barFill.style.width = pct + "%";
      correctCount.textContent = String(correct);
      tryCount.textContent = String(tries);

      const done = idx >= total;
      doneChip.textContent = done ? "Level complete! üéâ" : "Keep going! üíó";
    }

    function setUIForLevel(){
      const level = getLevel();
      subtitle.textContent = level.subtitle;
      levelPill.textContent = level.name;
      goalPill.textContent = level.goal;

      // Instruction text
      footerText.textContent =
        (levelIndex < 2)
          ? "Type the letter shown. It will change when you get it right."
          : "Type the whole word shown. Press Enter when you finish the word (or it will auto-check).";

      // Input hints
      document.getElementById("hint").textContent =
        (levelIndex < 2)
          ? "Tip: Press the letter once. (Lowercase in Level 1, UPPERCASE in Level 2.)"
          : "Tip: Type the word. It will check as you type (or press Enter).";

      // Reset per level
      idx = 0;
      tries = 0;
      correct = 0;
      typeInput.value = "";
      setStatus("", "Ready!");
      renderTarget();
      updateProgress();
      highlightNextKey();
      focusInput();
    }

    function renderTarget(){
      const level = getLevel();
      const current = getCurrentTarget();
      const total = level.items.length;

      if(idx >= total){
        targetEl.innerHTML = `<span style="color:var(--red); font-size:34px; font-weight:1000;">‚úÖ Great job!</span>
                              <span class="tiny">Press ‚ÄúChange Level‚Äù to try the next one.</span>`;
        nextUp.textContent = "Next: ‚Äî";
        setStatus("good","Level complete!");
        barFill.style.width = "100%";
        clearKeyStates();
        return;
      }

      // Display target (big)
      targetEl.innerHTML = `${escapeHtml(current)} <span class="tiny">(type it!)</span>`;

      // Next preview
      const next = level.items[idx + 1];
      nextUp.textContent = next ? `Next: ${next}` : "Next: done!";
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[s]));
    }

    function popHeart(){
      const frame = document.getElementById("frame");
      const layer = document.createElement("div");
      layer.className = "hearts";
      frame.appendChild(layer);

      const h = document.createElement("div");
      h.className = "heart";
      const hearts = ["‚ù§","üíó","üíû","üíï"];
      h.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      const x = 80 + Math.random() * (frame.clientWidth - 160);
      const y = frame.clientHeight - 90;
      h.style.left = x + "px";
      h.style.top = y + "px";
      layer.appendChild(h);

      setTimeout(()=> layer.remove(), 1200);
    }

    function advance(){
      idx++;
      correct++;
      typeInput.value = "";
      setStatus("good","Correct!");
      popHeart();
      renderTarget();
      updateProgress();
      highlightNextKey();
    }

    function checkTyped(force=false){
      const level = getLevel();
      const total = level.items.length;
      if(idx >= total) return;

      const target = getCurrentTarget();
      let typed = typeInput.value;

      // For letter levels, only consider last character typed
      if(levelIndex < 2){
        if(typed.length === 0) { highlightNextKey(); return; }
        typed = typed.slice(-1);
        typeInput.value = typed; // keep it to 1 char
      }

      // For word level, we can check live:
      // - If typed is longer than target, it's wrong
      // - If force (Enter) or exact match, evaluate
      tries += 0; // tries counted on evaluation
      const wantsEval =
        (levelIndex < 2) ? true :
        (force || typed.length >= target.length);

      if(levelIndex === 2){
        // show assist based on next missing character
        highlightNextKey();

        // prefix guidance (doesn't penalize yet)
        if(target.startsWith(typed)){
          setStatus("", "Keep going‚Ä¶");
          dot.classList.remove("bad","good");
          return;
        } else if(typed.length > 0){
          // wrong prefix
          setStatus("bad","Oops‚Äîcheck the next letter.");
          return;
        } else {
          setStatus("", "Ready!");
          return;
        }
      }

      if(!wantsEval) return;

      // Evaluate attempt
      tries++;
      tryCount.textContent = String(tries);

      const ok = level.expects(target, typed);

      if(ok){
        advance();
      } else {
        setStatus("bad","Try again!");
        // keep input but select for quick retry
        typeInput.select();
        highlightNextKey();
      }
    }

    function focusInput(){
      typeInput.focus({preventScroll:true});
    }

    // ---------- Events ----------
    // Keep focus in the input for young learners
    document.addEventListener("click", (e)=>{
      const isButton = e.target.closest("button, label, input[type=checkbox]");
      if(!isButton) focusInput();
    });

    // Typing input
    typeInput.addEventListener("input", ()=>{
      // For words: provide live feedback; for letters: check instantly
      if(levelIndex < 2){
        checkTyped();
      } else {
        checkTyped(false);
      }
    });

    // Enter to submit word
    typeInput.addEventListener("keydown", (e)=>{
      // Visual press highlight
      const keyName = e.code;
      const kEl = document.getElementById("key-" + keyName) ||
                 document.querySelector(`.key[data-key="${(e.key||"").toUpperCase()}"]`);
      if(kEl) kEl.classList.add("isPressed");

      if(e.key === "Enter"){
        e.preventDefault();
        if(levelIndex === 2){
          checkTyped(true);
        }
      }
    });

    typeInput.addEventListener("keyup", (e)=>{
      document.querySelectorAll(".key.isPressed").forEach(k=>k.classList.remove("isPressed"));
    });

    // Assist toggle
    assistToggle.addEventListener("change", ()=>{
      highlightNextKey();
      focusInput();
    });

    // Change level
    levelBtn.addEventListener("click", ()=>{
      levelIndex = (levelIndex + 1) % LEVELS.length;
      setUIForLevel();
    });

    // Reset
    resetBtn.addEventListener("click", ()=>{
      setUIForLevel();
    });

    // Also highlight on real keyboard presses (even if not focusing)
    document.addEventListener("keydown", (e)=>{
      const upper = (e.key || "").toUpperCase();
      const key = document.querySelector(`.key[data-key="${upper}"]`);
      if(key) key.classList.add("isPressed");
      if(e.code === "Space") document.getElementById("key-Space")?.classList.add("isPressed");
      if(e.code === "ShiftLeft") document.getElementById("key-ShiftLeft")?.classList.add("isPressed");
      if(e.code === "ShiftRight") document.getElementById("key-ShiftRight")?.classList.add("isPressed");
    });
    document.addEventListener("keyup", ()=>{
      document.querySelectorAll(".key.isPressed").forEach(k=>k.classList.remove("isPressed"));
    });

    // ---------- Init ----------
    setUIForLevel();
  </script>
</body>
</html>
